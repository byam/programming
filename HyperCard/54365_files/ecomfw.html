/**
This file is generated by a compression script.
Please DO NOT edit it directly or your changes may be lost.
See General Javascript Guidelines on the techwiki for more information.

Compressed by rmunson on Thu Sep 17 12:56:56 EDT 2009 
*/

/** START
  *    File: ecom/ecomfw.js
  *    Last Updated: Wed Sep 16 14:58:43 2009
*/
/*
* @version ecomfw.js v2.53.1457 09.16.2009
* @author Paul Bronshteyn
* @comment Built by a geek loaded on caffeine ...
* @copyright (c) Conde Nast Digital
*/
if(typeof CNP==="undefined"||!CNP){var CNP={};}CNP.ecom=(function(){var Y="ecom",U=null,s=null,l=true,P=false,M={idx:0},aa="",r=[],H=document,y=location,u=y.search,ai=Y+"_test",S="ecommerce_test_site",T=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,ag=/(^\d{5}$)|(^\d{5}-\d{4}$)/,Q=navigator.userAgent.toLowerCase(),f={safari:/webkit/.test(Q),opera:/opera/.test(Q),msie:/msie/.test(Q)&&!/opera/.test(Q),mozilla:/mozilla/.test(Q)&&!/(compatible|webkit)/.test(Q)},F=((f.mozilla||f.safari)?"offset":"scroll")+"Height",n={allure:[9,""],architecturaldigest:[9,""],bonappetit:[9,""],cookie:[9,""],details:[5,"condenet"],glamour:[12,"condeglamour"],gq:[5,"condenet"],golfdigest:[9,""],luckymag:[9,""],newyorker:[9,""],portfolio:[12,"condenastportfolio"],self:[12,"condenastgourmet"],style:[5,"condenet"],teenvogue:[12,"condeteenvogue"],traveler:[16,"condenasttraveler"],vanityfair:[12,"condevanityfair"],vogue:[5,"condenet"],wired:[9,"condewiredmag"]},ab=function(aj){var al=A("div"),ak=A("iframe");al.id=Y+"usc";W(al.style,{width:H.body.scrollWidth+"px",height:H.body.scrollHeight+"px",filter:"alpha(opacity = 80)",opacity:".80",zIndex:110000000,position:"absolute",left:"0px",top:"0px",background:"#000000"});H.body.appendChild(al);H.body.style.overflow="hidden";X(true);W(ak,{id:Y+"usf",src:i(aj,"iframe","true"),width:749,height:669,scrolling:"no"});W(ak.style,{background:"#ffffff",border:"0px",position:"absolute",zIndex:120000000,left:(H.body.scrollWidth/2-ak.width/2)+"px",top:(H.documentElement.scrollTop||H.body.scrollTop)+50+"px"});H.body.appendChild(ak);k("load",ak,function(){try{this.height=this.contentDocument.body[F]+"px";}catch(am){}});k("resize",window,function(){var an=d(Y+"usc"),am=d(Y+"usf");an.style.width=H.body.scrollWidth+"px";an.style.height=H.body.scrollHeight+"px";am.style.left=(H.body.scrollWidth/2-am.width/2)+"px";});al=ak=null;},A=function(ak,aj){return(aj||H).createElement(ak);},d=function(ak,aj){return(aj||H).getElementById(ak);},m=function(aj,ak){return(ak||H).getElementsByTagName(aj)||[];},X=function(am){var al=m("select"),ak=0,aj=al.length;for(;ak<aj;ak++){al[ak].style.visibility=(am)?"hidden":"";}},h=function(ak,aj){return(aj)?encodeURIComponent(ak):decodeURIComponent(ak);},q=function(aj){return(aj&&aj.firstChild)?aj.firstChild.nodeValue:"";},i=function(al,am,ak){if((a(al)&&ak==null)||a(am)){return"";}var aj=new RegExp("(^|[?=&|]+)"+am+"=([^&|]*)(&|$)?","i"),an=al.match(aj);if(ak==null){return(an||"")[2]||"";}if(an){return al.replace(aj,(a(ak)?"":"$1"+am+"="+ak));}else{return al+=(al.match(/\?/)?"&":"?")+am+"="+ak;}},ae=function(aj){if(M[aj].fid){try{M[aj].fid.frameElement.style.height=M[aj].doc.body[F]+"px";}catch(ak){}}},k=function(aj,ak,al){if(ak.attachEvent){ak.attachEvent("on"+aj,al);}else{ak.addEventListener(aj,al,false);}ak=null;},G=function(aj,ak,al){if(ak.detachEvent){ak.detachEvent("on"+aj,al);}else{ak.removeEventListener(aj,al,false);}ak=null;},z=function(){return(location.protocol==="https:"||af.https)?"https://":"http://";},x=function(){var ak=y.hostname.split(":")[0].split("."),aj=ak.length;return ak.slice(aj-2,aj).join(".");},g=function(){return"magazine."+x();},N=function(){return i(O.get("amg_user_record"),"uid");},E=function(){return((y.pathname.split("/")[1]||"").match(/^[^\.]*$/)||[""])[0];},Z=function(){s=A("img");k("load",s,c);k("error",s,R);k("abort",s,R);s.src=af.host+af.pingPath+"?ts="+(new Date()).getTime()+((af.user)?"&amgUserId="+af.user:"")+"&parent.referrer="+h(H.referrer,true);U=setTimeout(R,af.timeout*1000);},J=function(){clearTimeout(U);G("load",s,c);G("error",s,R);G("abort",s,R);s=null;},c=function(){if(!l){return;}J();P=true;if(af.callalive){V(af.callalive);}C();for(var aj;aj=r.shift();){ah(aj);}},R=function(){J();l=P=false;r=M=null;if(af.calldead){V(af.calldead);}},w=function(al,an,am,ak){am=W(am,{"js.enc":(af.jsEnc==="jsesc"?"jsesc":true),encType:M[al].enc,"js.callback":((M[al].fid)?"parent.":"")+"CNP.ecom.response","js.reqId":al,tgt:M[al].tgt});var aj=A("script");aj.type="text/javascript";aj.id=Y+al+((ak)?ak:"");aj.src=af.host+an+"?ts="+(new Date()).getTime()+"&"+j(am);M[al].p.appendChild(aj);aj=null;},p=function(aj){var ak=d(Y+aj);if(ak){M[aj].p.removeChild(ak);}ak=null;},ah=function(aj){if(af.user){M[aj].params.amgUserId=af.user;}if(af.section){M[aj].params.section=af.section;}if(M[aj].callbefore){V(M[aj].callbefore,M[aj].fid);}w(aj,af.offerPath,M[aj].params);},V=function(ak,aj){ak.func=ak.func||"";ak.params=ak.params||{};aj=aj||window;if(typeof ak.func==="function"){ak.func.call(this,ak.params);}else{if(typeof aj[ak.func]==="function"){aj[ak.func].call(this,ak.params);}}},j=function(al){var ak=[],aj;for(aj in al){ak.push(aj+"="+h(al[aj],true));}return ak.join("&");},O={get:function(ak){var am=H.cookie.split("; "),al=[],an=0,aj=am.length;for(;an<aj;an++){al=am[an].split("=");if(al[0]===ak){return h(al.slice(1).join("="));}}return"";},del:function(aj){return this.set(aj,"",{expires:-1});},set:function(ak,an,aj){aj=aj||{};an=an||"";aj.expires=aj.expires instanceof Date?aj.expires.toGMTString():typeof aj.expires==="number"?(new Date(+(new Date)+aj.expires*60*60*1000)).toGMTString():"";aj.path="/";aj.domain=af.domain;var al=[ak+"="+h(an,true)],am;for(am in aj){al.push(am+"="+aj[am]);}return aj.secure&&al.push("secure"),H.cookie=al.join(";"),true;}},W=function(aj,al){for(var ak in al){aj[ak]=al[ak];}return aj;},b=function(ak){ak=ak||"";var al=-1,aj=ak.length;while(ak.charCodeAt(--aj)<33){}while(++al<aj&&ak.charCodeAt(al)<33){}return ak.slice(al,aj+1);},a=function(aj){return !/\S/.test(aj||"");},ad={required:function(aj){return{res:!a(aj),msg:this.title+" is required"};},email:function(aj){return{res:a(aj)||T.test(aj),msg:"Please enter a valid email address"};},zipcode:function(aj){return{res:a(aj)||ag.test(aj),msg:"Please enter a valid zipcode"};}},K=function(al,ak,aj){return function(){var an=d(al.name+"_err_"+aj),am={},ap=0,ao=ak.length;for(;ap<ao;ap++){am=ad[ak[ap]].call(al,al.value);if(!am.res){an.innerHTML=am.msg;an.style.display="block";break;}an.style.display="none";}ae(aj);return am.res;};},o=function(am){if(!am){return{};}var aj={},al=am.elements,ao,an=0,ak=al.length;for(;an<ak;an++){ao=al[an];if(ao.tagName!=="FIELDSET"&&ao.type!=="submit"){aj[ao.name]=ao.value;}}return aj;},D=function(au){var aj=m("form",M[au].p)[0],al=aj.elements,ao=0,ak=al.length;if(!aj||!ak){return false;}M[au].fh=[];for(;ao<ak;ao++){var at=[],ap=al[ao],am=(ap.className)?ap.className.split(/\s/):[],aq=0,ar=am.length;if(!ar){continue;}if(ap.type==="submit"){M[au].btn=ap;continue;}for(;aq<ar;aq++){if(am[aq] in ad){at.push(am[aq]);}}if(at.length){var an=new K(ap,at,au);M[au].fh.push(an);k("blur",ap,an);}}k("submit",aj,function(ay){if(ay.cancelable){ay.preventDefault();}ay.returnValue=false;var ax=true,aw=0,av=M[au].fh.length;for(;aw<av;aw++){ax&=M[au].fh[aw]();}if(ax){M[au].btn.disabled="disabled";M[au].btn.value="Processing";w(au,af.subPath,o(ay.srcElement||ay.target));M[au].frmto=setTimeout(function(){aj.reset();M[au].btn.disabled="";M[au].btn.value="Submit";var az=d("frm_error_"+au,M[au].doc);az.innerHTML="There was an error processing your order.<br />Please try again.";az.style.display="block";},5000);}return false;});},t=function(am){var al=m("input",M[am].p),ak=0,aj=al.length,an=i(u,"as"),ao;for(;ak<aj;ak++){ao=al[ak];if(ao.type==="radio"){k("change",ao,L);}if(ao.value===an&&!ao.checked){ao.checked=true;L.apply(ao,[ao]);}}},L=function(ak){var al=ak.srcElement||ak.target||ak,aj=al.form.action.split("?");aj[1]=((!aj[1])?"":"?"+aj[1]);al.form.action=aj[0]+i(aj[1],"as",al.value);},v=function(aj,al){var ak=al.match(/mboxCreate\(([^\)]*)\)/)[1];if(!ak||typeof mbox!=="function"){return;}M[aj].p.firstChild.className="";k("load",self,function(){I(aj,ak);});},I=function(ak,al){var aj=A("div"),an=al.replace(/'/g,"").split(","),am;aj.id="tempmbox"+ak;aj.style.display="none";M[ak].p.appendChild(aj);an.unshift(aj.id);am=mboxDefine.apply(this,an);am.w.addParameter("rid",ak);am.setFetcher(new mboxAjaxFetcher());am.getUID=function(){var aq=this.w.getParameters(),ap=0,ao=aq.length;for(;ap<ao;ap++){if(aq[ap].name==="rid"){return aq[ap].value;}}return 0;};an.shift();mboxUpdate.apply(this,an);aj=null;},C=function(){var ak=af.mboxClient||af.host.split(".")[1];if(!(ak in n)){return;}var aj=A("img");aj.src=z()+"mbox"+n[ak][0]+".offermatica.com/m2/"+(n[ak][1]||"condenastpublication")+"/ubox/image?mbox=sessionBox&mboxDefault="+z()+location.host+af.pixelPath;k("load",aj,function(){aj=null;});},B={s:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d:function(an){var am,aj="",al=0,ak=an.length;for(;al<ak;al+=4){am=(this.s.indexOf(an.charAt(al))&255)<<18|(this.s.indexOf(an.charAt(al+1))&255)<<12|(this.s.indexOf(an.charAt(al+2))&255)<<6|this.s.indexOf(an.charAt(al+3))&255;aj+=String.fromCharCode((am&16711680)>>16,(am&65280)>>8,am&255);}if(an.charCodeAt(al-2)===61){return aj.substring(0,aj.length-2);}else{if(an.charCodeAt(al-1)===61){return aj.substring(0,aj.length-1);}else{return aj;}}}},ac=function(){var ak=A("div"),aj=A("a");ak.id=ai;ak.innerHTML="!!! ATTENTION !!! YOU ARE USING ECOM PREVIEW SERVER !!! ATTENTION !!!<br />";W(ak.style,{zIndex:100000000,backgroundColor:"#FFD700",color:"#800000",padding:"4px",fontWeight:"bold",textAlign:"center",border:"1px solid #333333",marginBottom:"10px",position:"fixed",width:"100%",top:"0px"});aj.innerHTML="[ return to normal mode ]";aj.href="#";ak.appendChild(aj);H.body.appendChild(ak);k("click",aj,function(){O.del(ai);H.body.removeChild((e.srcElement||e.target).parentNode);y.search=i(u,S,"");return false;});ak=aj=null;},af={pingPath:"status.jsp",offerPath:"targetedOffer.jsp",subPath:"embeddedForm.jsp",upsellPath:"ccUpsell.jsp",showPath:"showOffer.jsp",domain:x(),host:g(),path:"/ecom/",user:N(),section:E(),timeout:2,https:false,callback:null,params:{},cdn:false,onload:false,contentEnc:"xml",jsEnc:"true",mboxClient:"",pixelPath:"/images/global/spacer.gif"};return{start:function(aj){if(i(u,"nojoy")==="1"){return l=P=false;}for(var al in af){af[al]=i(u,Y+al)||(aj||{})[al]||af[al];}if(af.cdn===false){var ak=i(u,S)||O.get(ai)||"";if(ak){O.set(ai,ak);k("load",self,ac);af.host=ak;}else{O.del(ai);}}else{O.del(ai);}document.domain=af.domain;af.host=z()+af.host.replace(/^https*:\/\/|\/+$/g,"")+af.path;Z();k("load",self,function(){mboxCreate=function(){return false;};if(i(u,"ecomupsell")==="true"){ab(af.host+af.upsellPath);}if(af.onload){af.onload=false;for(var am;am=r.shift();){ah(am);}}});aa=i(u,"nojoytgt");},mbox:function(ak,aj){if(typeof ak.getUID==="function"){w(ak.getUID(),af.showPath,{placementId:aj},"mbox");}},closeiframe:function(){H.body.style.overflow="visible";d(Y+"usf").style.display="none";d(Y+"usc").style.display="none";X(false);setTimeout(function(){H.body.removeChild(d(Y+"usf"));H.body.removeChild(d(Y+"usc"));},2000);},request:function(aj){if((!l&&!P)||aa.indexOf(aj.pid)!==-1){return;}aj=aj||{};aj.doc=(aj.fid)?aj.fid.document:H;aj.p=d(aj.pid,aj.doc);aj.params=aj.params||{};if(!aj.p){return;}aj.enc=aj.enc||af.contentEnc;M[++M.idx]=aj;if(!P||af.onload){return r.push(M.idx);}ah(M.idx);},response:function(au,al){if(typeof M[au]==="undefined"||a(al)){return;}M[au].code=al;var ap=b((af.jsEnc==="jsesc"?unescape(al):B.d(al))),av=null;if(a(ap)){return;}if(M[au].enc==="xml"){if(typeof DOMParser==="function"||typeof DOMParser==="object"){av=(new DOMParser()).parseFromString(ap,"text/xml");if(av.documentElement.nodeName==="parsererror"){return;}}else{av=new ActiveXObject("Microsoft.XMLDOM");av.async="false";av.loadXML(ap);if(av.parseError.errorCode!==0){return;}}if(!av){return;}if(m("targetedOffer",av)[0]){var ao=b(q(m("content",av)[0])),ak=b((ao.match(/<script[^>]*>([\s\S]*?)<\/script>/i)||[null,null])[1]);if(a(ao)){return;}M[au].p.innerHTML=ao.replace(/<script(.|\s)*?\/script>/g,"");switch(q(m("placementType",av)[0])){case"Banner":case"Link":if(!ak){break;}var ar=A("script");ar.type="text/javascript";ar.id=Y+"js"+au;if(f.msie){ar.text=ak;}else{ar.appendChild(H.createTextNode(ak));}M[au].p.appendChild(ar);M[au].p.removeChild(ar);ar=null;break;case"embeddedForm":D(au);break;case"autoSub":t(au);break;case"testPlacement":case"testPlacement_Banner":case"testPlacement_Link":v(au,ak);break;case"testPlacement_autoSub":v(au,ak);t(au);break;case"testPlacement_embeddedForm":v(au,ak);D(au);break;}if(M[au].callafter){V(M[au].callafter,M[au].fid);}}else{if(m("response",av)[0]){clearTimeout(M[au].frmto);var an=d("frm_error_"+au,M[au].doc);if(m("errors",av)[0]){var aj="",at=m("error",av),aq=0,am=at.length;for(;aq<am;aq++){aj+=q(m("errorMessage",at[aq])[0])+"<br />";}an.innerHTML=aj;an.style.display="block";}else{an.style.display="none";an.innerHTML="";if(m("ccUpsellPage",av)[0]){ab(q(m("ccUpsellPage",av)[0]));}m("form",M[au].p)[0].reset();}M[au].btn.disabled="";M[au].btn.value="Submit";}}}else{M[au].p.innerHTML=al;}ae(au);p(au);}};})();
/** END ecom/ecomfw.js */

